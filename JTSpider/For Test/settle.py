import requests
import pandas as pd
from tqdm import tqdm
import time
from datetime import datetime

headers = {
        'authority': 'jmsgw.jtexpress.com.cn',
        'accept': 'application/json, text/plain, */*',
        'accept-language': 'zh-CN,zh;q=0.9',
        'authtoken': '5914f308417840fdbda37d3dc8e4b7a8',
        'cache-control': 'max-age=2, must-revalidate',
        'content-type': 'application/json;charset=UTF-8',
        'lang': 'zh_CN',
        'origin': 'https://jms.jtexpress.com.cn',
        'referer': 'https://jms.jtexpress.com.cn/',
        'routename': 'scanQueryConstantlyNew',
        'sec-ch-ua': '^\\^.Not/A)Brand^\\^;v=^\\^99^\\^, ^\\^Google',
        'sec-ch-ua-mobile': '?0',
        'sec-ch-ua-platform': '^\\^Windows^\\^',
        'sec-fetch-dest': 'empty',
        'sec-fetch-mode': 'cors',
        'sec-fetch-site': 'same-site',
        'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36',
    }
waybillNoPool = [
"JT2909203589693",
"JT3007398887568",
"JT5131884273356",
"JT5131975372901",
"JT5130955480466",
"JT5131194935665",
"JT5131185829258",
"JT2909210567649",
"JT5131069110041",
"JT5131121836206",
"JT5132040926045",
"JT2909230209825",
"JT3007343779715",
"JT3007453220025",
"JT3007360382564",
"JT5131936039252",
"JT5131149106686",
"JT3007358985747",
"JT0005946243943",
"JT2909214542094",
"JT2909209112388",
"JT5131146387617",
"JT3007344581185",
"JT5131047739784",
"JT5131961436211",
"JT5132041987194",
"JT5131981627303",
"JT5131094902916",
"JT5131054487722",
"JT3007372710915",
"JT5132090963843",
"JT3007441980573",
"JT3007336462947",
"JT5131987669430",
"JT2909243433075",
"JT5131136032328",
"JT5131893322713",
"JT5131104820114",
"JT3007391044977",
"JT5132006523291",
"JT5131900826409",
"JT2909210717727",
"JT5131048685283",
"JT5131166083322",
"JT5131037294377",
"JT5131950091165",
"JT5131927879689",
"JT5131172976717",
"JT3007364719016",
"JT5131987678124",
"JT5130984367438",
"JT3007386872776",
"JT3007328005808",
"JT3007475974706",
"JT5131164583128",
"JT5132038291996",
"JT3007414144287",
"JT5131991231399",
"JT2909245512240",
"JT5130985721844",
"JT5130954459739",
"JT3007460238128",
"JT5131887701017",
"JT5131056430856",
"JT5131931186661",
"JT5131045160683",
"JT5131078285186",
"JT0005946936381",
"JT5132030551823",
"JT3007443165749",
"JT5130902076442",
"JT5131038284276",
"JT5130891730729",
"JT3007465869419",
"JT3007319654235",
"JT3007454035334",
"JT3007444817827",
"JT3007417243348",
"JT2909243537362",
"JT2909244387665",
"JT3007445008603",
"JT3007417386686",
"JT5131975507111",
"JT3007444648271",
"JT5131911993880",
"JT3007468475172",
"JT5131934501949",
"JT5131962215046",
"JT5131917906872",
"JT2909243343702",
"JT5131954425676",
"JT5131954596886",
"JT5131977168349",
"JT5131917874461",
"JT5131912217456",
"JT5131917873311",
"JT5131917370492",
"JT3007444741411",
"JT3007444741633",
"JT5132117288120",
"JT3007417908253",
"JT5131917906021",
"JT5131917882527",
"JT5131917363759",
"JT3007417975585",
"JT3007417678487",
"JT3007459221339",
"JT5131917362723",
"JT5131911992263",
"JT5131912217547",
"JT5131917369757",
"JT3007458944632",
"JT3007444865905",
"JT5132018305845",
"JT3007418152569",
"JT3007444697987",
"JT3007486263050",
"JT5131911871724",
"JT3007417794615",
"JT5131917918872",
"JT2909245667539",
"JT3007417695108",
"JT5131917117628",
"JT5131322969862",
"JT5131881329499",
"JT3007380573170",
"JT5131878612870",
"JT5131882264491",
"JT0005956061905",
"JT5131041429620",
"JT2909200723634",
"JT5131909778246",
"JT3007297470221",
"JT5131902105808",
"JT5131072396267",
"JT2909245023837",
"JT5132010554362",
"JT5131916283565",
"JT5132126843874",
"JT3007287155630",
"JT5132021756700",
"JT2909242639194",
"JT5131966440858",
"JT2909275973520",
"JT5131946310303",
"JT2909272327767",
"JT5132116353893",
"JT5131989924566",
"JT5132021749272",
"JT5132133260144",
"JT5132112067193",
"JT3006960229900",
"JT5132102635749",
"JT5131970183541",
"JT3007346444110",
"JT2909246329063",
"JT2909231080508",
"JT5130336398183",
"JT2909232703801",
"JT5131137050201",
"JT5131154550175",
"JT2909225272666",
"JT0005949007858",
"JT5132100423456",
"JT3007372557661",
"JT5131107861765",
"JT5131060709678",
"JT5131031211514",
"JT5131150147392",
"JT5131178602613",
"JT2909272698463",
"JT5131044572219",
"JT5132120383847",
"JT5130991867952",
"JT5130968659950",
"JT2909253093628",
"JT5132111345469",
"JT5131041217699",
"JT5131144594198",
"JT3007360786768",
"JT5130989860807",
"JT2951375688786",
"JT3007459618736",
"JT2909252053138",
"JT5131089971237",
"JT0005950335250",
"JT5132114257846",
"JT5130401441429",
"JT5131129100457",
"JT5131106668309",
"JT5130951312700",
"JT5131092899679",
"JT5131103282808",
"JT5130980794664",
"JT2909204554765",
"JT5131142321251",
"JT3007460334841",
"JT5131114290900",
"JT2951305982457",
"JT5131105918146",
"JT5131914428860",
"JT2909163247767",
"JT5131150330077",
"JT5131082703414",
"JT2909242664049",
"JT5130968896853",
"JT5131139695502",
"JT3007351999360",
"JT3007327157806",
"JT3007340575514",
"JT5132102416439",
"JT5131040262279",
"JT5131144583715",
"JT5131134723110",
"JT5131988860889",
"JT3007477671793",
"JT5131110093990",
"JT5131062485472",
"JT3007405219513",
"JT3007378725621",
"JT5131897517201",
"JT5130976619224",
"JT5131062673812",
"JT5130950799715",
"JT5131966431493",
"JT5131960880872",
"JT5132029146804",
"JT5132102636424",
"JT5131956913085",
"JT5131956899821",
"JT5131960896012",
"JT3007454328774",
"JT5131961169356",
"JT5131961079878",
"JT2909244431703",
"JT5131926962730",
"JT5131134606377",
"JT2909271345039",
"JT2909244431769",
"JT5131356603370",
"JT5132055307297",
"JT5131960877266",
"JT5132133151967",
"JT3007470189666",
"JT5132127248654",
"JT5131997630198",
"JT0005951893453",
"JT5132021747607",
"JT5131966438289",
"JT2909259345317",
"JT2909243035517",
"JT2909247057213",
"JT5132122034042",
"JT5131960880770",
"JT5131961160542",
"JT5132055319128",
"JT2909259522491",
"JT2909271631288",
"JT5131995895559",
"JT3007441967585",
"JT5131963563116",
"JT3007487564062",
"JT5131960890434",
"JT5131074311066",
"JT5131956902577",
"JT5131956903558",
"JT2909259522479",
"JT5132006564325",
"JT5130878151943",
"JT5132055307195",
"JT5131956904982",
"JT5132052229281",
"JT2909243035493",
"JT5131960898392",
"JT2909244431816",
"JT3007422049263",
"JT5131058649924",
"JT5132029133390",
"JT5131960872705",
"JT5131531164058",
"JT2909271935244",
"JT3007463257237",
"JT5131960888821",
"JT5131183403723",
"JT3007463798091",
"JT3007480503486",
"JT3007380818232",
"JT2909223316631",
"JT0005952222708",
"JT5131085688752",
"JT5131058833726",
"JT3007385317015",
"JT5131112520982",
"JT5131961419563",
"JT2951375621959",
"JT5130973233381",
"JT5131891277918",
"JT5132150225904",
"JT5131911081679",
"JT5132023045614",
"JT0005941861296",
"JT5132012505398",
"JT5131997103093",
"JT5131960880349",
"JT5132107241820",
"JT5131961171607",
"JT5131916280453",
"JT5131960901139",
"JT3007006221445",
"JT5131995908976",
"JT5131916072742",
"JT5130922163458",
"JT5132018365236",
"JT5132056000857",
"JT5132151239938",
"JT5132010551852",
"JT5131960891653",
"JT2909244431872",
"JT5131960888547",
"JT5131966437184",
"JT2909248352812",
"JT5131960896158",
"JT5131874156389",
"JT5131966439577",
"JT2909271631460",
"JT2909244431714",
"JT5132028373413",
"JT5131960890490",
"JT5131960904718",
"JT5132029241450",
"JT5132107245651",
"JT2909271631335",
"JT5131960897242",
"JT5132074633141",
"JT5131960890207",
"JT5131960889211",
"JT5132023250199",
"JT5131969674297",
"JT5132130668785",
"JT0005951802333",
"JT0005953631639",
"JT5131960888252",
"JT2909244431894",
"JT5131960896896",
"JT5131964241126",
"JT5132124258788",
"JT2909245751720",
"JT5131960875613",
"JT5132022735500",
"JT5132086976747",
"JT5131960875588",
"JT5131869953302",
"JT0005926097696",
"JT2909204681447",
"JT5130968320073",
"JT5131056994556",
"JT5131066701549",
"JT5131903641772",
"JT5131186648670",
"JT5132035266085",
"JT5132046627751",
"JT5130943554792",
"JT2909212274203",
"JT2909228008281",
"JT5131113704990",
"JT5131195807079",
"JT5131939226116",
"JT5130968977841",
"JT5131122841539",
"JT5131034461824",
"JT3007384921132",
"JT5131961410759",
"JT3007389790990",
"JT5131073575930",
"JT3007396314057",
"JT3007460673869",
"JT3007334393641",
"JT3007415436314",
"JT5131106689480",
"JT5130910159013",
"JT5130975959227",
"JT5131874149748",
"JT5132008366469",
"JT5132105355115",
"JT0005928888824",
"JT3007454571015",
"JT2909198398604",
"JT5131086760102",
"JT3007344782837",
"JT2909225729160",
"JT5132107326956",
"JT3007478336134",
"JT5131114294559",
"JT5131899792853",
"JT5131186405326",
"JT5131150500415",
"JT5131194805307",
"JT2909208110981",
"JT3007385300041",
"JT2909216975929",
"JT5131880339636",
"JT5131872888670",
"JT5131099986084",
"JT5131106351722",
"JT5131507972955",
"JT5131087319551",
"JT3007357553666",
"JT5131113702994",
"JT3007383585637",
"JT3007354265100",
"JT5131056935919",
"JT5131500039299",
"JT5131057485174",
"JT3007339153257",
"JT5131195601540",
"JT3007365518178",
"JT3007478379348",
"JT5131178510764",
"JT5131507976195",
"JT5132057920834",
"JT5131171956156",
"JT2909233682813",
"JT5132103954296",
"JT2909182175579",
"JT3007413870721",
"JT5131961443614",
"JT3007349930056",
"JT5131055561736",
"JT5130920567376",
"JT5131961443090",
"JT3007452692020",
"JT3007320970879",
"JT5131898057462",
"JT5131507972944",
"JT2951284874040",
"JT5131194347536",
"JT5130981431595",
"JT5131162950645",
"JT5131072272729",
"JT5131088465092",
"JT5131507976322",
"JT5131956898317",
"JT3007315257290",
"JT5131194068977",
"JT5131170418300",
"JT3007387678700",
"JT5131105573514",
"JT5131911979357",
"JT3007445878494",
"JT3007417437926",
"JT5131982516089",
"JT3007417492656",
"JT2909245271864",
"JT3007417198331",
"JT3007417780179",
"JT3007418150358",
"JT5131917907660",
"JT5132107343126",
"JT5131967642506",
"JT5131917873571",
"JT5131971572158",
"JT3007419316900",
"JT3007417950820",
"JT3007487500215",
"JT5131917876525",
"JT5131917876876",
"JT5132109522601",
"JT3007418187648",
"JT5131173997111",
"JT3007331949748",
"JT5131054433026",
"JT5131064848926",
"JT3007363867058",
"JT2909245758213",
"JT5131997103775",
"JT2909242432501",
"JT2909266973776",
"JT2909269493406",
"JT2909267302493",
"JT2909264642907",
"JT5132124256931",
"JT2909243845159",
"JT5131872889639",
"JT5131903501545",
"JT2909209530208",
"JT5130937297630",
"JT5131047283833",
"JT5131179919831",
"JT5131118885369",
"JT5131092193582",
"JT5131050688869",
"JT2909231222120",
"JT5131169143143",
"JT3007394648827",
"JT5131971124454",
"JT2909272657465",
"JT0005947314760",
"JT3007450579080",
"JT3007411350760",
"JT3007445930675",
"JT5131983091923",
"JT3007489974364",
"JT5131917905244",
"JT3007441765483",
"JT3007445738928",
"JT3007446072733",
"JT5132114131277",
"JT5131971177566",
"JT5131964177906",
"JT3007403791274",
"JT3007445832829",
"JT3007489444174",
"JT3007445690552",
"JT3007447977941",
"JT0005953214522",
"JT5131130008120",
"JT5131030855908",
"JT5132118508067",
"JT5131507972933",
"JT3007348694674",
"JT5131065903082",
"JT5131886234364",
"JT5131876522712",
"JT3007398294470",
"JT5131878873375",
"JT3007384724791",
"JT5131164641631",
"JT5130976920892",
"JT2909251365280",
"JT5131961413349",
"JT5132068901773",
"JT3007368785201",
"JT2909231368893",
"JT5131090407762",
"JT3007368891760",
"JT5131169144453",
"JT5131507974304",
"JT5132106224166",
"JT5131132348435",
"JT0005948110283",
"JT3007361599433",
"JT5131048816173",
"JT3007376472572",
"JT5131136161445",
"JT5131061984407",
"JT5131894569973",
"JT2909227979624",
"JT5131883550378",
"JT5130932317524",
"JT5131087332296",
"JT3007349642077",
"JT3007361069398",
"JT5130990491999",
"JT5131195619708",
"JT5131525002046",
"JT5131903283563",
"JT0005953336576",
"JT5131101734633",
"JT5131103133147",
"JT5131120292061",
"JT5131135652698",
"JT5131123919712",
"JT3007395442273",
"JT5131087361262",
"JT5131132810553",
"JT3007425553925",
"JT5131931882350",
"JT2909243912166",
"JT2909245270431",
"JT5131940593357",
"JT2909252580769",
"JT5131938223565",
"JT3007430185855",
"JT5131938221092",
"JT2909245270475",
"JT2909255281720",
"JT5131961435809",
"JT2909254893863",
"JT5131938255267",
"JT3007392380304",
"JT5131062944417",
"JT3007371771253",
"JT5132130662196",
"JT5131882250542",
"JT5131144665160",
"JT5131952797274",
"JT5131911992934",
"JT5131917907659",
"JT3007444066479",
"JT5131964176152",
"JT5131971124396",
"JT3007445889413",
"JT5131959394490",
"JT3007445980619",
"JT3007444101062",
"JT3007417347249",
"JT5131963139796",
"JT5131967637007",
"JT5131917362030",
"JT5131954424606",
"JT3007418368396",
"JT3007458232377",
"JT3007477830036",
"JT2909254447490",
"JT2909245667471",
"JT3007417246521",
"JT5131967690497",
"JT5131917905459",
"JT5131917873162",
"JT5131964177111",
"JT3007417735718",
"JT5131984102554",
"JT5131917913377",
"JT3007418001218",
"JT3007469854936",
"JT5131036020158",
"JT5131197251384",
"JT5131926913595",
"JT5130968447894"
]
count = (len(waybillNoPool)-1) // 200 + 1
billNoFinal = pd.DataFrame()
for i in range(count):
    ifrom = i * 200
    ito = ifrom + 200
    pre_data = {"current": 1, "size": 1000, "startDates": "2022-07-13 00:00:00", "endDates": "2022-07-13 23:59:59","scanType": "全部", "sortName": "scanDate", "sortOrder": "desc","bilNos": waybillNoPool[ifrom:ito], "queryTerminalDispatchCode": 0, "querySub": "","reachAddressCodeList": [], "sendSites": [], "billType": 1, "countryId": "1"}
    pre_req = requests.post('https://jmsgw.jtexpress.com.cn/bigdataoperatingplatform/scanRecordQuery/listPage',headers=headers, json=pre_data).json()
    max_pages = pre_req["data"]["pages"]
    billNoSum = pd.DataFrame()
    for pages in range(1,max_pages):
        data = {"current": pages, "size": 1000, "startDates": "2022-07-13 00:00:00", "endDates": "2022-07-13 23:59:59","scanType": "全部", "sortName": "scanDate", "sortOrder": "desc","bilNos": waybillNoPool[ifrom:ito], "queryTerminalDispatchCode": 0, "querySub": "","reachAddressCodeList": [], "sendSites": [], "billType": 1, "countryId": "1"}
        response = requests.post('https://jmsgw.jtexpress.com.cn/bigdataoperatingplatform/scanRecordQuery/listPage',headers=headers, json=data).json()
        billNoTemp = pd.DataFrame(response["data"]["records"])
        billNoTemp = billNoTemp[['billNo','belongNo','scanType','scanDate','inputDept']]
        billNoTemp.dropna(subset=['belongNo'], inplace=True)
        billNoSum = pd.concat([billNoSum, billNoTemp])
    billNoFinal = pd.concat([billNoFinal, billNoSum])
billNoFinal.to_excel("TEST.xlsx", index=False)
